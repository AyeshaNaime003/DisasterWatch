{% extends 'index.html' %}

{% load static %}

{% block title %}Admin Panel{% endblock title %}

{% block body %}

<!-- CUSTOM CSS -->

<!-- HTML -->
<div id="dashboard-page" class="container-fluid">
    <div class="row main-row">
        <!-- NAVBAR TAKING 1/12TH -->
        {% include 'app/navbar2.html' %}
        <!-- MAIN CONTENT TAKING 1/12TH -->
        <div class="col-md-11">
            <div class="container-fluid">
                <div class="row">
                    <div class="container error-container">
                        {% if messages %}
                        {% for message in messages %}
                        <p class="alert {% if message.tags == 'error' %}alert-danger{% elif message.tags == 'success' %}alert-success{% endif %}"
                          role="alert">
                          {{ message }}
                          {% endfor %}
                          </ul>
                          {% endif %}
                      </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h2>Add User</h2>
                        <form id="addUserForm" action="{% url 'admin-panel' %}" method="POST">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" class="form-control"  name="username" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" class="form-control" name="email" required>
                            </div>
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" class="form-control" name="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Add</button>
                        </form>
                        <hr>
                        <h2>All Users</h2>
                        <ul id="userList">
                            {% for user in users %}
                            <li onclick="selectUser('{{ user.id }}')">
                                <span>{{ user.username }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <h2>User Details</h2>
                            <div id="userDetailsContainer" style="display: none;">
                                <!-- Empty form initially -->
                                <form id="userDetailsForm" method="POST">

                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="username">Username</label>
                                        <input type="text" class="form-control" id="username" name="username" disabled >
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" class="form-control" id="email" name="email"  disabled>
                                    </div>
                                    <div class="form-group">
                                        <label for="contact">Contact</label>
                                        <input type="text" class="form-control" id="contact" name="contact"  disabled>
                                    </div>
                                    <div class="form-group">
                                        <label for="is_admin">Is Admin</label>
                                        <input type="checkbox" id="is_admin" name="is_admin" >
                                    </div>
                                    <!-- Add more user details as needed -->
                                    <button type="submit" id="editUserBtn" class="btn btn-primary">Edit</button>
                                    <button type="button" id="deleteUserBtn" class="btn btn-danger">Delete</button>
                                </form>
                            </div>



                            <!-- html from user_details.html -->
                            <hr>
                            <h3>Login History</h3>
                            <ul>
                                {% for login in selected_user.loginhistory_set.all %}
                                <li>{{ login.timestamp }} - {{ login.ip_address }}</li>
                                {% endfor %}
                            </ul>x
                        </div>
                        <div class="row">
                            <h2>Inference History</h2>
                            <!-- Add code to display inference history -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            


    function selectUser(userId) {
                $.ajax({
                    url: '/get-user-details/' + userId + '/',  // Endpoint to fetch user details
                    type: 'GET',
                    success: function(response) {

            $('#userId').val(response.id);
            $('#username').val(response.username);
            $('#email').val(response.email);
            $('#contact').val(response.contact);
            $('#is_admin').prop('checked', response.is_admin);
            console.log("form updated");
        $('#userDetailsContainer').css('display', 'block');
        var form = document.getElementById('userDetailsForm');
    form.action = "{% url 'edit-user' user_id=0 %}".replace('0', response.id);
        },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                    }
                });
            }
          

    // Edit button click event
    $('#editUserBtn').click(function() {
        // Handle edit functionality here
    });

    // Delete button click event
    $('#deleteUserBtn').click(function() {
        // Handle delete functionality here
    });


        </script>

        {% endblock body %}
{% extends 'index.html' %}
{% load static %}
{% block title %}Profile{% endblock title %}
{% block body %}
<link rel="stylesheet" href="{% static '/styles/profile.css' %}">


<div id="profilepage" class="container-fluid">
    <div class="row main-row">
        <!-- SIDEBAR -->
        {% include 'app/navbar2.html' %}
        <!-- RIGHT PANEL -->
        <div class="col-md-11">
            <div class="">
                {% comment %} <div class="container py-5" style='padding:0px;'> {% endcomment %}
                    <div class="container form-container">
                        <form action="{% url 'update-profile' %}" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-xl-4">
                                    <div class="card mb-4 mb-xl-0">
                                        <div class="card-header">Profile Picture</div>
                                        <div class="card-body text-center">
                                            <div class="profile-picture-container">
                                                {% if user.profile_picture %}
                                                <img id="profile-picture" src="{{ user.profile_picture.url }}"
                                                    class='profileImage' alt="Profile Picture">
                                                {% else %}
                                                <img id="profile-picture"
                                                    src="{% static 'profile_picture/default_profile_pic.jpg' %}"
                                                    class='profileImage' alt="Default Profile Picture">
                                                {% endif %}
                                                <input type="file" id="profile-picture-input" name="profile_picture"
                                                    style="display: none;" accept="image/*">
                                                <!-- Profile picture help block-->
                                            </div>
                                            <div class="small font-italic text-muted mb-4" style="margin-top:10px">JPG
                                                or PNG no larger than 5 MB</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-8">
                                    <!-- Account details card-->
                                    <div class="card mb-4">
                                        <div class="card-header">Account Details</div>
                                        <div class="card-body">
                                            <form action="{% url 'update-profile' %}" method="POST">
                                                {% csrf_token %}
                                                <!-- Form Group (username)-->
                                                <div class="mb-3">
                                                    <label class="small mb-1" for="inputUsername">Username</label>
                                                    <input class="form-control" id="inputUsername" type="text"
                                                        name="username" value="{{ user.username }}">
                                                </div>
                                                <!-- Form Row-->
                                                <div class="row gx-3 mb-3">
                                                    <!-- Form Group (first name)-->
                                                    <div class="col-md-6">
                                                        <label class="small mb-1" for="inputFirstName">First
                                                            name</label>
                                                        <input class="form-control" id="inputFirstName" type="text"
                                                            name="first_name" value="{{ user.first_name }}">
                                                    </div>
                                                    <!-- Form Group (last name)-->
                                                    <div class="col-md-6">
                                                        <label class="small mb-1" for="inputLastName">Last name</label>
                                                        <input class="form-control" id="inputLastName" type="text"
                                                            name="last_name" value="{{ user.last_name }}">
                                                    </div>
                                                </div>

                                                <!-- Form Row        -->
                                                <div class="mb-3">
                                                    <!-- Form Group (location)-->
                                                    {% comment %} <div class="col-md-6"> {% endcomment %}
                                                        <label class="small mb-1" for="inputLocation">Location</label>
                                                        <input class="form-control" id="inputLocation" type="text"
                                                            name="location" value="{{ user.location }}">
                                                        {% comment %}
                                                    </div> {% endcomment %}
                                                </div>
                                                <!-- Form Group (email address)-->
                                                <div class="mb-3">
                                                    <label class="small mb-1" for="inputEmailAddress">Email
                                                        address</label>
                                                    <input class="form-control" id="inputEmailAddress" type="email"
                                                        name="email" value="{{ user.email }}">
                                                </div>
                                                <!-- Form Row-->
                                                <div class="row gx-3 mb-3">
                                                    <!-- Form Group (phone number)-->
                                                    <div class="col-md-6">
                                                        <label class="small mb-1" for="inputPhone">Phone number</label>
                                                        <input class="form-control" id="inputPhone" type="tel"
                                                            name="contact-number" value="{{ user.contact }}">
                                                    </div>

                                                    <!-- Form Group (role)-->
                                                    <div class="mb-3">
                                                        <label class="small mb-1">Role</label>
                                                        <input class="form-control" id="inputRole" type="text"
                                                            value="{% if user.is_admin %}Admin{% else %}Employee{% endif %}"
                                                            readonly>
                                                    </div>

                                                </div>
                                                <!-- Save changes button-->
                                                <div class="text-center">
                                                    <button class="btn btn-primary" type="submit">Save changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">Inference History</div>
                                        <div class="card-body">
                                            <div class="container">
                                                <div class="row">
                                                    <div class="col">
                                                        <h2>Disaster Information</h2>
                                                        <div class="table-responsive">
                                                            <table class="table table-bordered">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Date of Inference</th>
                                                                        <th>Disaster Date</th>
                                                                        <th>Disaster Type</th>
                                                                        <th>Disaster Location</th>
                                                                        <th>Disaster Description</th>
                                                                        <th>Disaster Comments</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <!-- Assuming 'data' is a list of dictionaries containing the information -->
                                                                    
                                                                    {% for user_inference in user_inferences %}
                                                                    
                                                                        <tr>
                                                                            <td>{{ user_inference.created_at }}</td>
                                                                            <td>{{ user_inference.disaster_date }}</td>
                                                                            <td>{{ user_inference.disaster_type }}</td>
                                                                            <td>{{ user_inference.disaster_city }}, 
                                                                                {{user_inference.disaster_state }},
                                                                                {{ user_inference.disaster_country }}
                                                                            </td>
                                                                            <td>{{ user_inference.disaster_description }}
                                                                            </td>
                                                                            <td>{{ user_inference.disaster_comments }}</td>
                                                                            <td>
                                                                                <a href="{% url 'dashboard_with_id' inference_id=user_inference.id %}">View Details</a>
                                                                            </td>
                                                                        </tr>
                                                                    {% endfor %}
                                                                </a>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                                <div class="col-xl-12">

                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Error messages -->
    {% if messages %}
    {% for message in messages %}
    <div id="alert-container" class="position-fixed top-0 start-50 translate-middle-x mt-4" style="z-index: 1050">
        <div class="alert {% if message.tags == 'error' %}alert-danger{% elif message.tags == 'success' %}alert-success{% endif %}"
            role="alert">
            {{ message }}
        </div>
    </div>
    {% endfor %}
    <script>
        // Automatically remove alert after 5 seconds
        $(document).ready(function () {
            setTimeout(function () {
                $('#alert-container').fadeOut();
            }, 2000);
        });
    </script>
    {% endif %}


    <script>
        // JavaScript
        document.addEventListener('DOMContentLoaded', function () {
            const profilePicture = document.getElementById('profile-picture');
            const profilePictureInput = document.getElementById('profile-picture-input');
            profilePicture.addEventListener('click', function () {
                profilePictureInput.click();
            });

            profilePictureInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    profilePicture.src = e.target.result;
                };

                reader.readAsDataURL(file);
            });

        });
    </script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js'></script>


    {% endblock body %}
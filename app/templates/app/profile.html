{% extends 'index.html' %}
{% load static %}
{% block title %}Profile{% endblock title %}
{% block body %}
<link rel="stylesheet" href="{% static '/styles/profile.css' %}">


<div id="profilepage" class="container-fluid">
    <div class="row main-row">
        <!-- SIDEBAR -->
        {% include 'app/navbar2.html' %}
        <!-- RIGHT PANEL -->
        <div class="col-md-11">
            {% comment %} <div class="row"> {% endcomment %}
                <div class="card">
                    <div clas='card-body'>
                        <div class='row'>
                            <div class="col-8">
                                <div class='pt-5 px-5 pb-0 pageTitle'>
                                    PROFILE
                                    <p class='titleFooter'>Welcome to your profile page. You can check your profile details and activity here.<p>
                                </div> 
                                
                                <div class="card-title ms-5 row "><h4 class='col'>Inference History</h4> <h6 class='col mt-2 mb-0 text-end text-primary titleFooter'> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle mb-1 me-2" viewBox="0 0 16 16">
                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                    <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                                  </svg>    Click on any row to redirect to dashboard.</h6></div>
                                <div class='card ms-4 mb-3  tableDiv ' style="height: 470px; overflow-y: auto;">
                                    
                                    <div class="card-body mt-0 pt-0 pe-0 me-0" >
                                        {% if user_inferences %}
                                            <div class='mt-0'>
                                                <table class="table table-striped table-bordered table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Date of Inference</th>
                                                            <th>Disaster Date</th>
                                                            <th>Disaster Type</th>
                                                            <th>Disaster Location</th>
                                                            <th>Disaster Description</th>
                                                            <th>Disaster Comments</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody style='font-size:small'>
                                                        <!-- Assuming 'data' is a list of dictionaries containing the information -->
                                                        {% for user_inference in user_inferences %}
                                                        <tr class='clickable-row' data-href="{% url 'dashboard_with_id' inference_id=user_inference.id %}">
                                                            <td>{{ user_inference.created_at }}</td>
                                                            <td>{{ user_inference.disaster_date }}</td>
                                                            <td>{{ user_inference.disaster_type }}</td>
                                                            <td>{{ user_inference.disaster_city }}, 
                                                                {{user_inference.disaster_state }},
                                                                {{ user_inference.disaster_country }}
                                                            </td>
                                                            <td>{{ user_inference.disaster_description }}
                                                            </td>
                                                            <td>{{ user_inference.disaster_comments }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>

                                        {% else %}
                                            <div class='noInference' >
                                                <div class="d-flex flex-column align-items-center justify-content-center" >
                                                    <!-- Placeholder SVG -->
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="lightblue" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image">
                                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                                        <polyline points="21 15 16 10 5 21"></polyline>
                                                    </svg>
                                                    <p class="mt-3">You have not done any inference yet.</p>
                                                </div>
                                            </div>
                                        
                                        {% endif %}
                                        
                                    </div>
                                </div>
                            </div>
            
                            <div class='col '>
                                <form action="{% url 'update-profile' %}" method="POST" enctype="multipart/form-data">
                                    {% csrf_token %}
                                
                                    <div class="card m-3 profileDiv">
                                        {% comment %} <div class='card-title mt-3'><h4 class='text-center'>Profile</h4></div> {% endcomment %}
                                        
                                        <div class="card-body text-center">
                                            <div class="profile-picture-container">
                                                {% if user.profile_picture %}
                                                <img id="profile-picture" src="{{ user.profile_picture.url }}"
                                                    class='profileImage' alt="Profile Picture">
                                                {% else %}
                                                <img id="profile-picture"
                                                    src="{% static 'profile_picture/default_profile_pic.jpg' %}"
                                                    class='profileImage' alt="Default Profile Picture">
                                                {% endif %}
                                                <input type="file" id="profile-picture-input" name="profile_picture"
                                                    style="display: none;" accept="image/*">
                                                <!-- Profile picture help block-->
                                            </div>
                                            <div class="small font-italic text-muted " style="margin-top:10px">JPG
                                                or PNG no larger than 5 MB</div>
            
                                            <div class='text-start'>
                                                <form action="{% url 'update-profile' %}" method="POST">
                                                    {% csrf_token %}
                                                    <!-- Form Row-->
                                                    <div class="row gx-3 my-2">
                                                        <!-- Form Group (first name)-->
                                                        <div class="col-md-6">
                                                            <label class="small mb-1" for="inputFirstName">First
                                                                name</label>
                                                            <input class="form-control" id="inputFirstName" type="text"
                                                                name="first_name" value="{{ user.first_name }}">
                                                        </div>
                                                        <!-- Form Group (last name)-->
                                                        <div class="col-md-6">
                                                            <label class="small mb-1" for="inputLastName">Last name</label>
                                                            <input class="form-control" id="inputLastName" type="text"
                                                                name="last_name" value="{{ user.last_name }}">
                                                        </div>
                                                    </div>

                                                    <!-- Form Row-->
                                                    <div class="row gx-3 mb-2">
                                                        <!-- Form Group (phone number)-->
                                                        <div class="col-md-6">
                                                            <label class="small mb-1" for="inputPhone">Phone number</label>
                                                            <input class="form-control" id="inputPhone" type="tel"
                                                                name="contact-number" value="{{ user.contact }}">
                                                        </div>

                                                        <!-- Form Group (role)-->
                                                        <div class="col-md-6">
                                                            <label class="small mb-1">Role</label>
                                                            <input class="form-control" id="inputRole" type="text"
                                                                value="{% if user.is_admin %}Admin{% else %}Employee{% endif %}"
                                                                readonly>
                                                        </div>
            
                                                    </div>

                                                    <!-- Form Group (username)-->
                                                    <div class="mb-2">
                                                        <label class="small mb-1" for="inputUsername">Username</label>
                                                        <input class="form-control" id="inputUsername" type="text"
                                                            name="username" value="{{ user.username }}">
                                                    </div>
                                                    
                                                    <!-- Form Group (email address)-->
                                                    <div class="mb-2">
                                                        <label class="small mb-1" for="inputEmailAddress">Email
                                                            address</label>
                                                        <input class="form-control" id="inputEmailAddress" type="email"
                                                            name="email" value="{{ user.email }}">
                                                    </div>
                                    
                                                    <!-- Form Group (location)-->
                                                    <div class="mb-2">
                                                        <label class="small mb-1" for="inputLocation">Location</label>
                                                        <input class="form-control" id="inputLocation" type="text"
                                                            name="location" value="{{ user.location }}">
                                                    </div>
                                                    <!-- Save changes button-->
                                                    <div class="text-center mt-4">
                                                        <button class="btn btn-primary" type="submit">Save changes</button>
                                                    </div>
                                                </form>
                                            <div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% comment %} </div> {% endcomment %}
        </div>
    </div>
    <!-- Error messages -->
    {% if messages %}
    {% for message in messages %}
    <div id="alert-container" class="position-fixed top-0 start-50 translate-middle-x mt-4" style="z-index: 1050">
        <div class="alert {% if message.tags == 'error' %}alert-danger{% elif message.tags == 'success' %}alert-success{% endif %}"
            role="alert">
            {{ message }}
        </div>
    </div>
    {% endfor %}
    <script>
        // Automatically remove alert after 5 seconds
        $(document).ready(function () {
            setTimeout(function () {
                $('#alert-container').fadeOut();
            }, 2000);
        });
    </script>
    {% endif %}


    <script>
        jQuery(document).ready(function($) {
            $(".clickable-row").click(function() {
                window.location = $(this).data("href");
            });
        });
        // JavaScript
        document.addEventListener('DOMContentLoaded', function () {
            const profilePicture = document.getElementById('profile-picture');
            const profilePictureInput = document.getElementById('profile-picture-input');
            profilePicture.addEventListener('click', function () {
                profilePictureInput.click();
            });

            profilePictureInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    profilePicture.src = e.target.result;
                };

                reader.readAsDataURL(file);
            });

        });
    </script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js'></script>


    {% endblock body %}